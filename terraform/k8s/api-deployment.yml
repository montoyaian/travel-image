- name: Desplegar la aplicación
  k8s:
    state: present
    definition: 
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: web
  tasks:
    - name: Imprimir el valor de TAG
      debug:
        msg: "El valor de TAG es {{ lookup('env', 'TAG') }}"
    - name: Desplegar la aplicación
      k8s:
        state: present
        definition: 
          apiVersion: apps/v1
          kind: Deployment
          metadata:
            name: web
          spec:
            replicas: 1
            selector:
              matchLabels:
                app: web
            template:
              metadata:
                labels:
                  app: web
              spec:
                containers:
                  - name: web
                    image: montoyita41/proyecto:{{ lookup('env', 'TAG') }}
                    ports:
                      - containerPort: 80
                    resources:
                      requests:
                        cpu: 250m
                      limits:
                        cpu: 500m


---
apiVersion: v1
kind: Service
metadata:
  name: web
spec:
  type: LoadBalancer
  ports:
  - port: 80
  selector:
    app: web-game
